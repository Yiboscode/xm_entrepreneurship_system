# IDEA远程调试配置指南

## 一、配置远程调试连接

### 1. 在IDEA中创建Remote Debug配置

1. 打开 IDEA
2. 点击右上角的 **Run/Debug Configurations** 下拉菜单
3. 点击 **Edit Configurations...**
4. 点击左上角的 **+** 号
5. 选择 **Remote JVM Debug**
6. 配置如下：

```
Name: Entrepreneurship Remote Debug
Host: collegetopics.cn
Port: 5005
Command line arguments for remote JVM: 
  -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=*:5005
Use module classpath: springboot
```

7. 点击 **OK** 保存

### 2. 启动远程调试

1. 确保服务器上的应用已启动（带调试端口）
2. 在代码中设置断点
3. 点击 IDEA 右上角的 **Debug** 按钮（绿色虫子图标）
4. 选择 **Entrepreneurship Remote Debug**
5. 看到 "Connected to the target VM" 表示连接成功

### 3. 使用断点调试

现在可以：
- ✅ 在任何Java代码中设置断点
- ✅ 当远程应用执行到断点时，会暂停
- ✅ 可以查看变量值
- ✅ 可以单步执行
- ✅ 可以计算表达式

**注意**：修改代码后需要重新打包部署到服务器！

## 二、VSCode远程开发配置

### 1. 安装插件

在VSCode中安装以下插件：
- **Remote - SSH**
- **Remote Development**

### 2. 配置SSH连接

1. 按 `F1` 或 `Ctrl+Shift+P`
2. 输入 `Remote-SSH: Connect to Host`
3. 点击 `Configure SSH Hosts...`
4. 选择第一个配置文件（通常是 `C:\Users\你的用户名\.ssh\config`）
5. 添加以下内容：

```
Host collegetopics
    HostName collegetopics.cn
    User ubuntu
    Port 22
    IdentityFile ~/.ssh/id_rsa  # 如果使用密钥
```

### 3. 连接到远程服务器

1. 按 `F1`，输入 `Remote-SSH: Connect to Host`
2. 选择 `collegetopics`
3. 输入密码（或使用SSH密钥）
4. 连接成功后，VSCode会重新打开

### 4. 打开远程项目

1. 点击 **File → Open Folder**
2. 输入路径：`/home/ubuntu/xm_entrepreneurship_system/vue`
3. 现在可以直接编辑远程服务器上的Vue代码了！

### 5. 实时预览和调试

连接到远程后：
- ✅ 直接编辑远程文件
- ✅ 在终端执行远程命令
- ✅ 使用Git管理远程代码
- ✅ 安装远程插件

## 三、一键启动停止脚本

### 本地Windows脚本

创建 `remote-control.ps1`:

```powershell
# 远程服务器控制脚本

param(
    [Parameter(Mandatory=$true)]
    [ValidateSet('start','stop','restart','status','logs')]
    [string]$Action
)

$server = "ubuntu@collegetopics.cn"
$projectPath = "~/xm_entrepreneurship_system"

switch ($Action) {
    'start' {
        Write-Host "启动所有服务..." -ForegroundColor Green
        ssh $server "cd $projectPath && docker compose up -d"
    }
    'stop' {
        Write-Host "停止所有服务..." -ForegroundColor Yellow
        ssh $server "cd $projectPath && docker compose down"
    }
    'restart' {
        Write-Host "重启所有服务..." -ForegroundColor Cyan
        ssh $server "cd $projectPath && docker compose restart"
    }
    'status' {
        Write-Host "查看服务状态..." -ForegroundColor Blue
        ssh $server "cd $projectPath && docker compose ps"
    }
    'logs' {
        Write-Host "查看日志..." -ForegroundColor Magenta
        ssh $server "cd $projectPath && docker compose logs --tail=100"
    }
}
```

使用方法：
```powershell
# 启动
.\remote-control.ps1 -Action start

# 停止
.\remote-control.ps1 -Action stop

# 重启
.\remote-control.ps1 -Action restart

# 查看状态
.\remote-control.ps1 -Action status

# 查看日志
.\remote-control.ps1 -Action logs
```

### IDEA集成工具（更方便）

#### 方法1：External Tools

1. **Settings → Tools → External Tools**
2. 点击 **+** 添加新工具

**启动服务**：
```
Name: 启动远程服务
Program: ssh
Arguments: ubuntu@collegetopics.cn "cd ~/xm_entrepreneurship_system && docker compose up -d"
Working directory: $ProjectFileDir$
```

**停止服务**：
```
Name: 停止远程服务
Program: ssh
Arguments: ubuntu@collegetopics.cn "cd ~/xm_entrepreneurship_system && docker compose down"
Working directory: $ProjectFileDir$
```

**查看日志**：
```
Name: 查看远程日志
Program: ssh
Arguments: ubuntu@collegetopics.cn "cd ~/xm_entrepreneurship_system && docker compose logs --tail=100 backend"
Working directory: $ProjectFileDir$
```

3. 使用：**Tools → External Tools → 启动远程服务**

#### 方法2：Run Configuration

创建 **Shell Script** 配置：
1. Run → Edit Configurations
2. 添加 → Shell Script
3. Script text: `ssh ubuntu@collegetopics.cn "cd ~/xm_entrepreneurship_system && docker compose up -d"`

## 四、代码自动同步方案

### 方案A：IDEA Deployment（推荐）

1. **Settings → Build, Execution, Deployment → Deployment**
2. 点击 **+** 添加 SFTP 服务器

```
Name: Entrepreneurship Server
Type: SFTP
Host: collegetopics.cn
Port: 22
Username: ubuntu
Password: ****
Root path: /home/ubuntu/xm_entrepreneurship_system
```

3. **Mappings**:
```
Local path: C:\Users\ya942\Desktop\college\xm_entrepreneurship_system
Deployment path: /
Web path: https://collegetopics.cn
```

4. **Options**:
- ✅ Upload changed files automatically to the default server: Always
- ✅ Upload external changes: Always

现在每次保存文件都会自动上传到服务器！

### 方案B：Git + Webhook（自动化）

1. 在服务器上配置Git自动拉取
2. 推送到GitHub后自动触发服务器更新
3. 适合团队协作

### 方案C：rsync同步（Linux/Mac）

```bash
# 监听本地文件变化并同步
fswatch -o ./springboot | xargs -n1 -I{} rsync -avz --exclude 'target' ./springboot ubuntu@collegetopics.cn:~/xm_entrepreneurship_system/
```

## 五、开发工作流程

### 推荐流程：混合模式

#### 日常开发（本地）
```
1. 本地IDEA开发后端
2. 本地VSCode开发前端
3. 连接远程MySQL测试
4. 代码提交到Git
```

#### 快速测试（远程调试）
```
1. 推送代码到服务器
2. 重启远程容器
3. IDEA连接远程调试端口
4. 设置断点测试
```

#### 生产部署（正式）
```
1. 本地打包
2. 上传到服务器
3. Docker重新构建
4. 一键重启服务
```

## 六、快捷键设置

在IDEA中设置快捷键：

1. **Settings → Keymap**
2. 搜索 "External Tools"
3. 为以下工具设置快捷键：
   - 启动远程服务: `Ctrl+Alt+S`
   - 停止远程服务: `Ctrl+Alt+D`
   - 查看远程日志: `Ctrl+Alt+L`

## 七、故障排查

### 问题1：无法连接到远程调试端口

```bash
# 检查端口是否开放
telnet collegetopics.cn 5005

# 检查防火墙
sudo ufw status
sudo ufw allow 5005
```

### 问题2：代码修改后不生效

- 远程调试**不支持**热重载
- 修改代码后需要重新打包部署
- 或者使用JRebel等热重载工具

### 问题3：SSH密钥认证

生成SSH密钥（避免每次输入密码）：
```bash
# 本地生成密钥
ssh-keygen -t rsa -b 4096

# 上传公钥到服务器
ssh-copy-id ubuntu@collegetopics.cn
```

## 八、高级技巧

### 1. 使用Spring Boot DevTools（开发环境）

添加依赖：
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-devtools</artifactId>
    <optional>true</optional>
</dependency>
```

### 2. 容器内开发（终极方案）

使用VSCode的Dev Containers插件，直接在Docker容器内开发：
- 环境完全一致
- 不需要本地安装任何依赖
- 代码实时生效

### 3. 多环境配置

创建不同的配置文件：
- `application-dev.yml` - 本地开发
- `application-test.yml` - 远程测试
- `application-prod.yml` - 生产环境

启动时指定：
```bash
java -jar app.jar --spring.profiles.active=test
```

## 九、推荐的最佳实践

✅ **本地开发 + 远程数据库**
- 开发快，调试方便
- 数据真实
- 不需要每次部署

✅ **提交前在远程测试**
- 确保环境一致
- 发现潜在问题

✅ **使用Git管理代码**
- 版本控制
- 协作开发
- CI/CD自动化

✅ **Docker容器后台运行**
- 稳定可靠
- 易于管理
- 资源隔离

